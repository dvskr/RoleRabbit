// Prisma schema for RoleReady Database - Profile Feature Only

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String  @id @default(cuid())
  email          String  @unique
  name           String
  password       String? // Optional for OAuth users
  provider       String  @default("local") // local, google, github
  providerId     String? @unique
  profilePicture String?

  // Extended Profile Fields
  firstName         String?
  lastName          String?
  phone             String?
  location          String?
  bio               String?
  currentRole       String?
  currentCompany    String?
  experience        String?
  industry          String?
  jobLevel          String?
  employmentType    String?
  availability      String?
  salaryExpectation String?
  workPreference    String?
  linkedin          String?
  github            String?
  website           String?

  // JSON fields for complex data
  skills               String? // JSON array
  certifications       String? // JSON array
  languages            String? // JSON array
  education            String? // JSON array
  careerGoals          String? // JSON array
  targetRoles          String? // JSON array
  targetCompanies      String? // JSON array
  socialLinks          String? // JSON array
  projects             String? // JSON array
  achievements         String? // JSON array
  careerTimeline       String? // JSON array
  workExperiences      String? // JSON array of work experience objects
  volunteerExperiences String? // JSON array of volunteer experience objects
  recommendations      String? // JSON array of recommendations/testimonials
  publications         String? // JSON array of publications
  patents              String? // JSON array of patents
  organizations        String? // JSON array of organizations/associations
  testScores           String? // JSON array of test scores

  // Preferences
  jobAlerts          Boolean @default(true)
  emailNotifications Boolean @default(true)
  smsNotifications   Boolean @default(false)
  privacyLevel       String? @default("Professional")
  profileVisibility  String? @default("Public")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  refreshTokens       RefreshToken[]
  sessions            Session[]
  passwordResetTokens PasswordResetToken[]

  // AI Usage tracking
  totalAIUsage Int @default(0)
  aiUsageLimit Int @default(100000) // 100K tokens per month

  // Two-Factor Authentication
  twoFactorEnabled     Boolean @default(false)
  twoFactorSecret      String?
  twoFactorBackupCodes String? // JSON array of backup codes

  // Profile Analytics & Metrics
  profileViews         Int @default(0)
  successRate          Int @default(0) // Percentage
  profileCompleteness   Int @default(0) // Percentage (0-100)
  skillMatchRate       Int @default(0) // Percentage
  avgResponseTime      Float @default(0) // Days

  @@map("users")
}

model RefreshToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@map("refresh_tokens")
}

model Session {
  id           String   @id @default(cuid())
  userId       String
  device       String? // Device info (desktop, mobile, tablet)
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime @default(now())
  lastActivity DateTime @default(now())
  expiresAt    DateTime
  isActive     Boolean  @default(true)
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isActive])
  @@index([expiresAt])
  @@map("sessions")
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  createdAt DateTime @default(now())
  expiresAt DateTime
  used      Boolean  @default(false)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
  @@map("password_reset_tokens")
}
