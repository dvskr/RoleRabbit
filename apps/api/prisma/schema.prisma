generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ai_drafts {
  id           String       @id
  userId       String
  baseResumeId String
  action       AIAction
  payload      Json
  metadata     Json?
  expiresAt    DateTime
  createdAt    DateTime     @default(now())
  updatedAt    DateTime
  base_resumes base_resumes @relation(fields: [baseResumeId], references: [id], onDelete: Cascade)
  users        users        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([baseResumeId])
  @@index([expiresAt])
  @@index([userId])
}

model ai_request_logs {
  id                String             @id
  userId            String
  baseResumeId      String?
  tailoredVersionId String?
  action            AIAction
  provider          String?
  model             String?
  tokensUsed        Int?
  costUsd           Decimal?           @db.Decimal(12, 4)
  status            String             @default("success")
  errorMessage      String?
  metadata          Json?
  createdAt         DateTime           @default(now())
  base_resumes      base_resumes?      @relation(fields: [baseResumeId], references: [id])
  tailored_versions tailored_versions? @relation(fields: [tailoredVersionId], references: [id])
  users             users              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([action, createdAt])
  @@index([action])
  @@index([baseResumeId])
  @@index([tailoredVersionId])
  @@index([userId, action, createdAt])
  @@index([userId, createdAt])
  @@index([userId])
}

model analytics_events {
  id         String   @id
  userId     String
  event      String
  properties String   @default("{}")
  sessionId  String?
  timestamp  DateTime @default(now())
  createdAt  DateTime @default(now())
  users      users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([event])
  @@index([event, timestamp])
  @@index([timestamp])
  @@index([userId])
  @@index([userId, timestamp])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model base_resumes {
  id                                           String                @id
  userId                                       String
  slotNumber                                   Int
  name                                         String
  isActive                                     Boolean               @default(false)
  data                                         Json
  formatting                                   Json?                 @default("{}")
  metadata                                     Json?                 @default("{}")
  lastAIAccessedAt                             DateTime?
  parsingConfidence                            Float?
  createdAt                                    DateTime              @default(now())
  updatedAt                                    DateTime
  embedding                                    String?
  embedding_updated_at                         DateTime?
  fileHash                                     String?
  storageFileId                                String?
  ai_drafts                                    ai_drafts[]
  ai_request_logs                              ai_request_logs[]
  storage_files                                storage_files?        @relation(fields: [storageFileId], references: [id])
  users_base_resumes_userIdTousers             users                 @relation("base_resumes_userIdTousers", fields: [userId], references: [id], onDelete: Cascade)
  generated_documents                          generated_documents[]
  resume_cache                                 resume_cache[]
  tailored_versions                            tailored_versions[]
  tailoring_analytics                          tailoring_analytics[]
  users_users_activeBaseResumeIdTobase_resumes users?                @relation("users_activeBaseResumeIdTobase_resumes")
  working_drafts                               working_drafts?

  @@unique([userId, slotNumber])
  @@index([fileHash])
  @@index([storageFileId])
  @@index([userId, isActive])
  @@index([userId, updatedAt])
}

model certifications {
  id            String        @id
  profileId     String
  name          String
  issuer        String?
  date          String?
  expiryDate    String?
  credentialId  String?
  credentialUrl String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  user_profiles user_profiles @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([issuer])
  @@index([profileId])
}

model company_insights {
  id        String   @id
  jobId     String
  userId    String
  type      String
  title     String
  content   String
  source    String?
  date      String
  createdAt DateTime @default(now())
  updatedAt DateTime
  jobs      jobs     @relation(fields: [jobId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([jobId])
  @@index([type])
  @@index([userId])
}

model credential_reminders {
  id           String      @id
  credentialId String
  reminderDate DateTime
  isSent       Boolean     @default(false)
  priority     String      @default("medium")
  createdAt    DateTime    @default(now())
  credentials  credentials @relation(fields: [credentialId], references: [id], onDelete: Cascade)

  @@index([credentialId])
  @@index([isSent])
  @@index([reminderDate])
}

model credentials {
  id                   String                 @id
  userId               String
  fileId               String?
  credentialType       String
  name                 String
  issuer               String
  issuedDate           String
  expirationDate       String?
  credentialId         String?
  verificationUrl      String?
  qrCode               String?
  verificationStatus   String                 @default("pending")
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  credential_reminders credential_reminders[]
  storage_files        storage_files?         @relation(fields: [fileId], references: [id])
  users                users                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([credentialType])
  @@index([fileId])
  @@index([userId])
  @@index([verificationStatus])
}

model education {
  id            String        @id
  profileId     String
  institution   String
  degree        String?
  field         String?
  endDate       String?
  description   String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  startDate     String?
  gpa           String?
  honors        String?
  location      String?
  user_profiles user_profiles @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([institution])
  @@index([profileId])
}

model file_access_logs {
  id            String        @id
  fileId        String
  userId        String
  action        String
  ipAddress     String?
  userAgent     String?
  createdAt     DateTime      @default(now())
  storage_files storage_files @relation(fields: [fileId], references: [id], onDelete: Cascade)
  users         users         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([fileId])
  @@index([userId])
}

model file_comments {
  id                                  String          @id
  fileId                              String
  userId                              String
  content                             String          @db.VarChar(5000)
  parentId                            String?
  isResolved                          Boolean         @default(false)
  createdAt                           DateTime        @default(now())
  updatedAt                           DateTime
  editedAt                            DateTime?
  editedBy                            String?
  mentions                            String[]        @default([])
  users_file_comments_editedByTousers users?          @relation("file_comments_editedByTousers", fields: [editedBy], references: [id])
  storage_files                       storage_files   @relation(fields: [fileId], references: [id], onDelete: Cascade)
  file_comments                       file_comments?  @relation("file_commentsTofile_comments", fields: [parentId], references: [id], onDelete: Cascade)
  other_file_comments                 file_comments[] @relation("file_commentsTofile_comments")
  users_file_comments_userIdTousers   users           @relation("file_comments_userIdTousers", fields: [userId], references: [id], onDelete: Cascade)

  @@index([editedBy])
  @@index([fileId])
  @@index([parentId])
}

model file_shares {
  id                                  String         @id
  fileId                              String
  userId                              String
  sharedWith                          String
  permission                          FilePermission @default(VIEW)
  expiresAt                           DateTime?
  createdAt                           DateTime       @default(now())
  updatedAt                           DateTime
  notifiedAt                          DateTime?
  accessedAt                          DateTime?
  lastAccessedAt                      DateTime?
  createdBy                           String?
  updatedBy                           String?
  storage_files                       storage_files  @relation(fields: [fileId], references: [id], onDelete: Cascade)
  users_file_shares_sharedWithTousers users          @relation("file_shares_sharedWithTousers", fields: [sharedWith], references: [id], onDelete: Cascade)
  users_file_shares_userIdTousers     users          @relation("file_shares_userIdTousers", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([fileId, sharedWith])
  @@index([accessedAt])
  @@index([createdBy])
  @@index([fileId])
  @@index([lastAccessedAt])
  @@index([sharedWith])
}

model generated_documents {
  id                String             @id
  userId            String
  baseResumeId      String?
  tailoredVersionId String?
  type              GeneratedDocType   @default(COVER_LETTER)
  templateId        String?
  tone              String?
  jobTitle          String?
  company           String?
  data              Json
  storagePath       String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime
  base_resumes      base_resumes?      @relation(fields: [baseResumeId], references: [id])
  tailored_versions tailored_versions? @relation(fields: [tailoredVersionId], references: [id])
  resume_templates  resume_templates?  @relation(fields: [templateId], references: [id])
  users             users              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([templateId])
  @@index([type])
  @@index([userId])
}

model idempotency_keys {
  id        String   @id
  key       String   @unique
  userId    String
  result    String?
  expiresAt DateTime
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([key])
  @@index([userId])
}

model interview_notes {
  id          String   @id
  jobId       String
  userId      String
  type        String
  date        String
  interviewer String?
  notes       String
  questions   String[] @default([])
  feedback    String?
  rating      Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  jobs        jobs     @relation(fields: [jobId], references: [id], onDelete: Cascade)
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([date])
  @@index([jobId])
  @@index([userId])
}

model job_attachments {
  id             String        @id
  jobId          String
  userId         String
  fileId         String
  attachmentType String        @default("other")
  createdAt      DateTime      @default(now())
  storage_files  storage_files @relation(fields: [fileId], references: [id], onDelete: Cascade)
  jobs           jobs          @relation(fields: [jobId], references: [id], onDelete: Cascade)
  users          users         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([jobId, fileId])
  @@index([fileId])
  @@index([jobId])
  @@index([userId])
}

model job_notes {
  id        String   @id
  jobId     String
  userId    String
  title     String
  content   String
  tags      String[] @default([])
  date      String
  category  String   @default("other")
  createdAt DateTime @default(now())
  updatedAt DateTime
  jobs      jobs     @relation(fields: [jobId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([jobId])
  @@index([userId])
}

model job_reminders {
  id          String      @id
  jobId       String
  userId      String
  title       String
  description String
  dueDate     String
  completed   Boolean     @default(false)
  priority    JobPriority @default(MEDIUM)
  type        String      @default("other")
  createdAt   DateTime    @default(now())
  updatedAt   DateTime
  jobs        jobs        @relation(fields: [jobId], references: [id], onDelete: Cascade)
  users       users       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([completed])
  @@index([dueDate])
  @@index([jobId])
  @@index([userId])
}

model jobs {
  id                String              @id
  userId            String
  title             String
  company           String
  location          String
  status            JobStatus           @default(APPLIED)
  priority          JobPriority?        @default(MEDIUM)
  appliedDate       String
  salary            String?
  description       String?
  url               String?
  notes             String?
  nextStep          String?
  nextStepDate      String?
  contact           Json?
  requirements      String[]            @default([])
  benefits          String[]            @default([])
  remote            Boolean             @default(false)
  companySize       String?
  industry          String?
  isFavorite        Boolean             @default(false)
  deletedAt         DateTime?
  createdAt         DateTime            @default(now())
  lastUpdated       DateTime
  company_insights  company_insights[]
  interview_notes   interview_notes[]
  job_attachments   job_attachments[]
  job_notes         job_notes[]
  job_reminders     job_reminders[]
  users             users               @relation(fields: [userId], references: [id], onDelete: Cascade)
  referral_contacts referral_contacts[]
  salary_offers     salary_offers[]

  @@index([appliedDate])
  @@index([company])
  @@index([deletedAt])
  @@index([isFavorite])
  @@index([priority])
  @@index([status])
  @@index([userId])
}

model languages {
  id            String        @id
  profileId     String
  name          String
  proficiency   String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  user_profiles user_profiles @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}

model password_reset_tokens {
  id        String   @id
  userId    String
  token     String   @unique
  createdAt DateTime @default(now())
  expiresAt DateTime
  used      Boolean  @default(false)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([token])
  @@index([userId])
}

model projects {
  id            String        @id
  profileId     String
  title         String
  description   String?
  technologies  String?
  date          String?
  link          String?
  github        String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  media         String?
  user_profiles user_profiles @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}

model prompt_tests {
  id              String          @id
  userId          String
  variantId       String
  operation       String
  variant         String
  inputHash       String
  success         Boolean
  durationMs      Int
  tokensUsed      Int?
  costUsd         Float?
  qualityScore    Float?
  userRating      Int?
  outputMetrics   String          @default("{}")
  error           String?
  createdAt       DateTime        @default(now())
  users           users           @relation(fields: [userId], references: [id], onDelete: Cascade)
  prompt_variants prompt_variants @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([operation])
  @@index([operation, variant, createdAt])
  @@index([userId])
  @@index([variantId])
  @@index([variant])
}

model prompt_variants {
  id           String         @id
  name         String
  operation    String
  variant      String
  prompt       String
  metadata     String         @default("{}")
  isActive     Boolean        @default(true)
  isControl    Boolean        @default(false)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  prompt_tests prompt_tests[]

  @@unique([operation, variant])
  @@index([isActive])
  @@index([operation])
}

model referral_contacts {
  id           String   @id
  jobId        String
  userId       String
  name         String
  position     String
  relationship String
  contacted    Boolean  @default(false)
  date         String
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  jobs         jobs     @relation(fields: [jobId], references: [id], onDelete: Cascade)
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([contacted])
  @@index([jobId])
  @@index([userId])
}

model refresh_tokens {
  id        String   @id
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([token])
  @@index([userId])
}

model resume_cache {
  id           String        @id
  userId       String
  baseResumeId String?
  fileHash     String        @unique
  method       String
  data         Json
  confidence   Float?
  hitCount     Int           @default(0)
  createdAt    DateTime      @default(now())
  lastUsedAt   DateTime      @default(now())
  expiresAt    DateTime?
  base_resumes base_resumes? @relation(fields: [baseResumeId], references: [id])
  users        users         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model resume_templates {
  id                      String                    @id
  name                    String
  category                TemplateCategory
  description             String
  preview                 String
  features                String[]
  difficulty              TemplateDifficulty
  industry                String[]
  layout                  TemplateLayout
  colorScheme             TemplateColorScheme
  isPremium               Boolean                   @default(false)
  rating                  Float                     @default(0)
  downloads               Int                       @default(0)
  author                  String                    @default("RoleReady Team")
  tags                    String[]
  templateData            Json?
  isActive                Boolean                   @default(true)
  isApproved              Boolean                   @default(true)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  generated_documents     generated_documents[]
  template_usage_history  template_usage_history[]
  user_template_favorites user_template_favorites[]

  @@index([category])
  @@index([difficulty])
  @@index([downloads])
  @@index([isActive])
  @@index([isPremium])
  @@index([rating])
  @@index([category], map: "idx_resume_templates_category")
}

model resumes {
  id                String   @id
  userId            String
  fileName          String
  templateId        String?
  data              Json
  sectionOrder      String[] @default([])
  sectionVisibility Json     @default("{}")
  customSections    Json     @default("[]")
  customFields      Json     @default("[]")
  formatting        Json     @default("{}")
  isStarred         Boolean  @default(false)
  isArchived        Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime
  users             users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([fileName])
  @@index([isArchived])
  @@index([isStarred])
  @@index([userId])
}

model salary_offers {
  id        String   @id
  jobId     String
  userId    String
  amount    Float
  currency  String   @default("USD")
  equity    String?
  benefits  String[] @default([])
  notes     String?
  date      String
  status    String   @default("initial")
  createdAt DateTime @default(now())
  updatedAt DateTime
  jobs      jobs     @relation(fields: [jobId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([jobId])
  @@index([status])
  @@index([userId])
}

model saved_views {
  id        String   @id
  userId    String
  name      String
  filters   Json
  columns   String[] @default([])
  createdAt DateTime @default(now())
  updatedAt DateTime
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model sessions {
  id           String   @id
  userId       String
  device       String?
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime @default(now())
  lastActivity DateTime @default(now())
  expiresAt    DateTime
  isActive     Boolean  @default(true)
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([isActive])
  @@index([userId])
}

model share_links {
  id             String         @id
  fileId         String
  userId         String
  token          String         @unique
  password       String?
  expiresAt      DateTime?
  maxDownloads   Int?
  downloadCount  Int            @default(0)
  createdAt      DateTime       @default(now())
  permission     FilePermission @default(VIEW)
  accessedAt     DateTime?
  lastAccessedAt DateTime?
  createdBy      String?
  updatedBy      String?
  storage_files  storage_files  @relation(fields: [fileId], references: [id], onDelete: Cascade)
  users          users          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([accessedAt])
  @@index([expiresAt])
  @@index([fileId])
  @@index([lastAccessedAt])
  @@index([token])
}

model skills {
  id          String        @id
  name        String        @unique
  category    String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime
  user_skills user_skills[]

  @@index([category])
  @@index([name])
}

model storage_files {
  id                                    String             @id
  userId                                String
  name                                  String
  fileName                              String
  type                                  String
  contentType                           String
  size                                  BigInt
  storagePath                           String
  publicUrl                             String?
  description                           String?
  isPublic                              Boolean            @default(false)
  isStarred                             Boolean            @default(false)
  isArchived                            Boolean            @default(false)
  folderId                              String?
  deletedAt                             DateTime?
  downloadCount                         Int                @default(0)
  viewCount                             Int                @default(0)
  createdAt                             DateTime           @default(now())
  updatedAt                             DateTime
  fileHash                              String?
  version                               Int                @default(1)
  isCorrupted                           Boolean            @default(false)
  thumbnail                             String?
  tags                                  String[]           @default([])
  expiresAt                             DateTime?
  lastAccessedAt                        DateTime?
  metadata                              Json?
  uploadedBy                            String?
  modifiedBy                            String?
  deletedBy                             String?
  base_resumes                          base_resumes[]
  credentials                           credentials[]
  file_access_logs                      file_access_logs[]
  file_comments                         file_comments[]
  file_shares                           file_shares[]
  job_attachments                       job_attachments[]
  share_links                           share_links[]
  storage_folders                       storage_folders?   @relation(fields: [folderId], references: [id])
  users_storage_files_modifiedByTousers users?             @relation("storage_files_modifiedByTousers", fields: [modifiedBy], references: [id])
  users_storage_files_uploadedByTousers users?             @relation("storage_files_uploadedByTousers", fields: [uploadedBy], references: [id])
  users_storage_files_userIdTousers     users              @relation("storage_files_userIdTousers", fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([updatedAt])
  @@index([deletedAt])
  @@index([expiresAt])
  @@index([fileHash])
  @@index([folderId])
  @@index([isArchived])
  @@index([isStarred])
  @@index([lastAccessedAt])
  @@index([modifiedBy])
  @@index([type])
  @@index([uploadedBy])
  @@index([userId])
  @@index([userId, deletedAt, type])
  @@index([userId, isStarred, deletedAt])
  @@index([userId, isArchived, deletedAt])
  @@index([userId, folderId, deletedAt])
  @@index([userId, createdAt])
  @@index([userId, updatedAt])
}

model file_versions {
  id            String   @id @default(uuid())
  fileId        String
  versionNumber Int
  fileName      String
  contentType   String
  size          BigInt
  storagePath   String
  fileHash      String?
  description   String?
  createdBy     String
  createdAt     DateTime @default(now())
  metadata      Json?

  @@unique([fileId, versionNumber])
  @@index([fileId])
  @@index([fileId, versionNumber])
  @@index([createdAt])
  @@index([createdBy])
}

model storage_folders {
  id                    String            @id
  userId                String
  name                  String
  parentId              String?
  color                 String?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime
  deletedAt             DateTime?
  description           String?
  icon                  String?
  sortOrder             Int               @default(0)
  metadata              Json?
  createdBy             String?
  deletedBy             String?
  updatedBy             String?
  storage_files         storage_files[]
  storage_folders       storage_folders?  @relation("storage_foldersTostorage_folders", fields: [parentId], references: [id], onDelete: Cascade)
  other_storage_folders storage_folders[] @relation("storage_foldersTostorage_folders")
  users                 users             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, name])
  @@index([deletedAt])
  @@index([parentId])
  @@index([sortOrder])
  @@index([userId])
  @@index([userId, deletedAt])
}

model storage_quotas {
  id         String           @id
  userId     String           @unique
  usedBytes  BigInt           @default(0)
  limitBytes BigInt           @default(5368709120)
  createdAt  DateTime         @default(now())
  updatedAt  DateTime
  tier       SubscriptionTier @default(FREE)
  warnedAt   DateTime?
  upgradedAt DateTime?
  users      users            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([tier])
  @@index([userId])
}

model tailored_versions {
  id                  String                @id
  baseResumeId        String
  userId              String
  jobTitle            String?
  company             String?
  jobDescriptionHash  String?
  mode                TailorMode            @default(PARTIAL)
  tone                String?
  data                Json
  diff                Json?
  atsScoreBefore      Int?
  atsScoreAfter       Int?
  isPromoted          Boolean               @default(false)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  ai_request_logs     ai_request_logs[]
  generated_documents generated_documents[]
  base_resumes        base_resumes          @relation(fields: [baseResumeId], references: [id], onDelete: Cascade)
  users               users                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([baseResumeId, createdAt])
  @@index([baseResumeId])
  @@index([jobDescriptionHash])
  @@index([userId, createdAt])
  @@index([userId])
}

model tailoring_analytics {
  id                 String       @id
  userId             String
  resumeId           String
  mode               String
  scoreBefore        Float
  scoreAfter         Float
  improvement        Float
  improvementRate    Float
  targetScore        Float
  targetMet          Boolean
  tokensUsed         Int?
  durationMs         Int
  confidence         Float        @default(0)
  warningCount       Int          @default(0)
  changeCount        Int          @default(0)
  keywordsAddedCount Int          @default(0)
  costEstimate       Float        @default(0)
  timestamp          DateTime     @default(now())
  createdAt          DateTime     @default(now())
  base_resumes       base_resumes @relation(fields: [resumeId], references: [id], onDelete: Cascade)
  users              users        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([mode])
  @@index([timestamp])
  @@index([userId])
  @@index([userId, timestamp])
}

model template_usage_history {
  id               String              @id
  userId           String
  templateId       String
  action           TemplateUsageAction
  metadata         Json?
  createdAt        DateTime            @default(now())
  resume_templates resume_templates    @relation(fields: [templateId], references: [id], onDelete: Cascade)
  users            users               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([templateId, createdAt])
  @@index([templateId])
  @@index([userId, createdAt])
  @@index([userId])
}

model user_profiles {
  id                  String             @id
  userId              String             @unique
  firstName           String?
  lastName            String?
  phone               String?
  location            String?
  profilePicture      String?
  linkedin            String?
  github              String?
  website             String?
  profileCompleteness Int                @default(0)
  createdAt           DateTime           @default(now())
  updatedAt           DateTime
  personalEmail       String?
  portfolio           String?
  professionalBio     String?
  certifications      certifications[]
  education           education[]
  languages           languages[]
  projects            projects[]
  users               users              @relation(fields: [userId], references: [id], onDelete: Cascade)
  user_skills         user_skills[]
  work_experiences    work_experiences[]

  @@index([userId])
}

model user_skills {
  id                String        @id
  profileId         String
  skillId           String
  yearsOfExperience Int?
  verified          Boolean       @default(false)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime
  user_profiles     user_profiles @relation(fields: [profileId], references: [id], onDelete: Cascade)
  skills            skills        @relation(fields: [skillId], references: [id], onDelete: Cascade)

  @@unique([profileId, skillId])
  @@index([profileId])
  @@index([skillId])
}

model user_template_favorites {
  id               String           @id
  userId           String
  templateId       String
  createdAt        DateTime         @default(now())
  resume_templates resume_templates @relation(fields: [templateId], references: [id], onDelete: Cascade)
  users            users            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, templateId])
  @@index([templateId])
  @@index([userId])
}

model user_template_preferences {
  id             String   @id
  userId         String   @unique
  filterSettings Json     @default("{}")
  sortPreference String   @default("popular")
  viewMode       String   @default("grid")
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  users          users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model users {
  id                                                  String                     @id
  email                                               String                     @unique
  name                                                String
  password                                            String?
  provider                                            String                     @default("local")
  providerId                                          String?                    @unique
  emailNotifications                                  Boolean                    @default(true)
  createdAt                                           DateTime                   @default(now())
  updatedAt                                           DateTime
  twoFactorEnabled                                    Boolean                    @default(false)
  twoFactorSecret                                     String?
  twoFactorBackupCodes                                String?
  activeBaseResumeId                                  String?                    @unique
  coverLetterAiUsageCount                             Int                        @default(0)
  coverLetterAiUsageResetAt                           DateTime?
  portfolioPublishesCount                             Int                        @default(0)
  portfolioPublishesResetAt                           DateTime?
  resumeAiUsageCount                                  Int                        @default(0)
  resumeAiUsageResetAt                                DateTime?
  subscriptionEndsAt                                  DateTime?
  subscriptionTier                                    SubscriptionTier           @default(FREE)
  tailorPreferredMode                                 TailorMode?                @default(PARTIAL)
  tailorPreferredTone                                 String?                    @default("professional")
  tailorPreferredLength                               String?                    @default("thorough")
  AbuseReport_Reporter                                AbuseReport[]              @relation("AbuseReports_Reporter")
  AbuseReport_Resolver                                AbuseReport[]              @relation("AbuseReports_Resolver")
  AuditLog                                            AuditLog[]
  DeletionRequest                                     DeletionRequest[]
  Portfolio                                           Portfolio[]
  PortfolioVersion                                    PortfolioVersion[]
  ReviewQueue_Assignee                                ReviewQueue[]              @relation("ReviewQueue_Assignee")
  ReviewQueue_Reviewer                                ReviewQueue[]              @relation("ReviewQueue_Reviewer")
  ai_drafts                                           ai_drafts[]
  ai_request_logs                                     ai_request_logs[]
  analytics_events                                    analytics_events[]
  base_resumes_base_resumes_userIdTousers             base_resumes[]             @relation("base_resumes_userIdTousers")
  company_insights                                    company_insights[]
  credentials                                         credentials[]
  file_access_logs                                    file_access_logs[]
  file_comments_file_comments_editedByTousers         file_comments[]            @relation("file_comments_editedByTousers")
  file_comments_file_comments_userIdTousers           file_comments[]            @relation("file_comments_userIdTousers")
  file_shares_file_shares_sharedWithTousers           file_shares[]              @relation("file_shares_sharedWithTousers")
  file_shares_file_shares_userIdTousers               file_shares[]              @relation("file_shares_userIdTousers")
  generated_documents                                 generated_documents[]
  idempotency_keys                                    idempotency_keys[]
  interview_notes                                     interview_notes[]
  job_attachments                                     job_attachments[]
  job_notes                                           job_notes[]
  job_reminders                                       job_reminders[]
  jobs                                                jobs[]
  password_reset_tokens                               password_reset_tokens[]
  prompt_tests                                        prompt_tests[]
  referral_contacts                                   referral_contacts[]
  refresh_tokens                                      refresh_tokens[]
  resume_cache                                        resume_cache[]
  resumes                                             resumes[]
  salary_offers                                       salary_offers[]
  saved_views                                         saved_views[]
  sessions                                            sessions[]
  share_links                                         share_links[]
  storage_files_storage_files_modifiedByTousers       storage_files[]            @relation("storage_files_modifiedByTousers")
  storage_files_storage_files_uploadedByTousers       storage_files[]            @relation("storage_files_uploadedByTousers")
  storage_files_storage_files_userIdTousers           storage_files[]            @relation("storage_files_userIdTousers")
  storage_folders                                     storage_folders[]
  storage_quotas                                      storage_quotas?
  tailored_versions                                   tailored_versions[]
  tailoring_analytics                                 tailoring_analytics[]
  template_usage_history                              template_usage_history[]
  user_profiles                                       user_profiles?
  user_template_favorites                             user_template_favorites[]
  user_template_preferences                           user_template_preferences?
  base_resumes_users_activeBaseResumeIdTobase_resumes base_resumes?              @relation("users_activeBaseResumeIdTobase_resumes", fields: [activeBaseResumeId], references: [id])
  webhook_configs                                     webhook_configs?
  webhook_logs                                        webhook_logs[]

  @@index([email])
  @@index([provider, providerId])
}

model webhook_configs {
  id            String   @id
  userId        String   @unique
  url           String
  secret        String
  enabled       Boolean  @default(true)
  enabledEvents String   @default("[]")
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  users         users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([enabled])
  @@index([userId])
}

model webhook_logs {
  id          String    @id
  userId      String
  event       String
  url         String
  payload     String
  success     Boolean
  statusCode  Int?
  attempts    Int       @default(1)
  error       String?
  deliveryId  String    @unique
  deliveredAt DateTime?
  createdAt   DateTime  @default(now())
  users       users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([deliveryId])
  @@index([event])
  @@index([success])
  @@index([userId, createdAt])
  @@index([userId])
}

model work_experiences {
  id            String        @id
  profileId     String
  company       String
  role          String
  location      String?
  startDate     String
  endDate       String?
  isCurrent     Boolean       @default(false)
  description   String?
  projectType   String?       @default("Full-time")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  technologies  String[]      @default([])
  user_profiles user_profiles @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([company])
  @@index([profileId])
}

model working_drafts {
  id           String       @id
  baseResumeId String       @unique
  data         Json
  formatting   Json?        @default("{}")
  metadata     Json?        @default("{}")
  createdAt    DateTime     @default(now())
  updatedAt    DateTime
  base_resumes base_resumes @relation(fields: [baseResumeId], references: [id], onDelete: Cascade)

  @@index([baseResumeId])
}

model Portfolio {
  id            String                @id @default(uuid())
  userId        String
  title         String
  slug          String                @unique
  description   String?
  content       Json
  templateId    String?
  theme         Json?
  seoSettings   Json?
  status        PortfolioStatus       @default(DRAFT)
  visibility    PortfolioVisibility   @default(PRIVATE)
  publishedAt   DateTime?
  customDomain  String?               @unique
  subdomain     String?               @unique
  viewCount     Int                   @default(0)
  shareCount    Int                   @default(0)
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  customDomains CustomDomain[]
  template      PortfolioTemplate?    @relation(fields: [templateId], references: [id])
  user          users                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  analytics     PortfolioAnalytics[]
  deployments   PortfolioDeployment[]
  media         PortfolioMedia[]
  shares        PortfolioShare[]
  versions      PortfolioVersion[]

  @@index([userId])
  @@index([slug])
  @@index([status])
  @@index([publishedAt])
  @@index([userId, status])
  @@index([userId, updatedAt])
}

model PortfolioTemplate {
  id          String      @id @default(uuid())
  name        String
  description String?
  thumbnail   String?
  category    String?
  structure   Json
  styles      Json?
  isPublic    Boolean     @default(true)
  downloads   Int         @default(0)
  rating      Float       @default(0)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  portfolios  Portfolio[]

  @@index([category])
  @@index([isPublic])
  @@index([rating])
  @@index([downloads])
}

model PortfolioVersion {
  id          String    @id @default(uuid())
  portfolioId String
  version     Int
  content     Json
  changeLog   String?
  createdBy   String
  createdAt   DateTime  @default(now())
  creator     users     @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  portfolio   Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@unique([portfolioId, version])
  @@index([portfolioId])
  @@index([createdBy])
  @@index([createdAt])
}

model PortfolioShare {
  id          String    @id @default(uuid())
  portfolioId String
  token       String    @unique
  expiresAt   DateTime?
  maxViews    Int?
  viewCount   Int       @default(0)
  isActive    Boolean   @default(true)
  password    String?
  createdAt   DateTime  @default(now())
  portfolio   Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([portfolioId])
  @@index([isActive])
  @@index([expiresAt])
}

model PortfolioAnalytics {
  id          String    @id @default(uuid())
  portfolioId String
  date        DateTime  @default(now())
  views       Int       @default(0)
  uniqueViews Int       @default(0)
  shares      Int       @default(0)
  referrer    String?
  country     String?
  city        String?
  device      String?
  browser     String?
  portfolio   Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@index([portfolioId, date])
  @@index([date])
  @@index([country])
}

model PortfolioDeployment {
  id          String           @id @default(uuid())
  portfolioId String
  version     Int
  status      DeploymentStatus
  deployedAt  DateTime?
  buildLog    String?
  errorLog    String?
  url         String?
  createdAt   DateTime         @default(now())
  portfolio   Portfolio        @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@index([portfolioId])
  @@index([status])
  @@index([createdAt])
}

model CustomDomain {
  id          String    @id @default(uuid())
  portfolioId String
  domain      String    @unique
  isVerified  Boolean   @default(false)
  sslEnabled  Boolean   @default(false)
  dnsRecords  Json?
  createdAt   DateTime  @default(now())
  verifiedAt  DateTime?
  portfolio   Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@index([domain])
  @@index([portfolioId])
  @@index([isVerified])
}

model PortfolioMedia {
  id          String    @id @default(uuid())
  portfolioId String
  type        String
  url         String
  filename    String
  size        BigInt
  mimeType    String
  thumbnail   String?
  metadata    Json?
  uploadedAt  DateTime  @default(now())
  portfolio   Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@index([portfolioId])
  @@index([type])
}

model AbuseReport {
  id          String       @id @default(uuid())
  portfolioId String
  reportedBy  String
  reason      AbuseReason
  description String?
  status      ReportStatus @default(PENDING)
  createdAt   DateTime     @default(now())
  resolvedAt  DateTime?
  resolvedBy  String?
  notes       String?
  reporter    users        @relation("AbuseReports_Reporter", fields: [reportedBy], references: [id], onDelete: Cascade)
  resolver    users?       @relation("AbuseReports_Resolver", fields: [resolvedBy], references: [id])

  @@index([portfolioId])
  @@index([status])
  @@index([reportedBy])
  @@index([createdAt])
}

model ReviewQueue {
  id               String         @id @default(uuid())
  portfolioId      String
  priority         ReviewPriority @default(MEDIUM)
  status           ReviewStatus   @default(PENDING)
  moderationResult Json?
  assignedTo       String?
  reviewedBy       String?
  reviewedAt       DateTime?
  notes            String?
  createdAt        DateTime       @default(now())
  assignee         users?         @relation("ReviewQueue_Assignee", fields: [assignedTo], references: [id])
  reviewer         users?         @relation("ReviewQueue_Reviewer", fields: [reviewedBy], references: [id])

  @@index([portfolioId])
  @@index([status])
  @@index([priority])
  @@index([assignedTo])
  @@index([createdAt])
}

model AuditLog {
  id         String   @id @default(uuid())
  userId     String
  action     String
  resource   String
  resourceId String?
  metadata   Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())
  user       users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([action])
  @@index([resource])
  @@index([createdAt])
  @@index([userId, createdAt])
}

model DeletionRequest {
  id           String         @id @default(uuid())
  userId       String
  reason       String?
  status       DeletionStatus @default(PENDING)
  scheduledFor DateTime
  completedAt  DateTime?
  createdAt    DateTime       @default(now())
  user         users          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([scheduledFor])
}

enum AIAction {
  GENERATE_CONTENT
  TAILOR_PARTIAL
  TAILOR_FULL
  APPLY_RECOMMENDATIONS
  COVER_LETTER
  PORTFOLIO
  JD_ANALYSIS
  ATS_SCORE
}

enum GeneratedDocType {
  COVER_LETTER
  PORTFOLIO_SECTION
  OTHER
}

enum JobPriority {
  LOW
  MEDIUM
  HIGH
}

enum JobStatus {
  APPLIED
  INTERVIEW
  OFFER
  REJECTED
}

enum SubscriptionTier {
  FREE
  PRO
  PREMIUM
}

enum TailorMode {
  PARTIAL
  FULL
}

enum TemplateCategory {
  ATS
  CREATIVE
  MODERN
  CLASSIC
  EXECUTIVE
  MINIMAL
  ACADEMIC
  TECHNICAL
  STARTUP
  FREELANCE
}

enum TemplateColorScheme {
  MONOCHROME
  BLUE
  GREEN
  PURPLE
  RED
  ORANGE
  CUSTOM
}

enum TemplateDifficulty {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum TemplateLayout {
  SINGLE_COLUMN
  TWO_COLUMN
  HYBRID
}

enum TemplateUsageAction {
  PREVIEW
  DOWNLOAD
  USE
  FAVORITE
  SHARE
}

enum FilePermission {
  VIEW
  COMMENT
  EDIT
  ADMIN
}

enum PortfolioStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
  SUSPENDED
}

enum PortfolioVisibility {
  PUBLIC
  PRIVATE
  UNLISTED
}

enum DeploymentStatus {
  PENDING
  BUILDING
  DEPLOYED
  FAILED
}

enum AbuseReason {
  SPAM
  HARASSMENT
  INAPPROPRIATE_CONTENT
  COPYRIGHT_VIOLATION
  MALWARE
  PHISHING
  OTHER
}

enum ReportStatus {
  PENDING
  UNDER_REVIEW
  RESOLVED
  DISMISSED
}

enum ReviewStatus {
  PENDING
  APPROVED
  REJECTED
  NEEDS_CHANGES
}

enum ReviewPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum DeletionStatus {
  PENDING
  CANCELLED
  COMPLETED
}
